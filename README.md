# BU SSO Example

This Node.js web application demonstrates SSO authentication provided by BU's Shibboleth Server using the `passport-saml` package.

Config
======
In order to use Shibboleth authentication, your application requires a certificate/private key pair, as well as BU's Shibboleth Identity Provider (IdP) Certificate. The files should be named as such:

- `cert.pem`: SP's certificate (Generated by you)
- `key.pem`: SP's private key (Generated by you)
- `cert_idp.pem`: IdP's certificate (BU's is contained in https://shib-test.bu.edu/idp/shibboleth)

Alternatively, instead of storing the certificates in files, they can be stored as environment variables. Simply collapse the contents of each file into one line, inserting `\n` for line breaks, and then store them in your `.env` file. This can be useful when running your application on a service like Heroku and you want to minimize the number/size of files uploaded, or you are not allowed to upload extra files, etc.

Creating Private Key and Certificates
=====================================
Generate your certificate/private key files with the following command:
- `openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -nodes -days 900`

The [IdP Certificate](https://shib-test.bu.edu/idp/shibboleth) is contained within the `ds:X509Certificate` tag.
- Copy the tag's contents into a file named `cert_idp.pem`.

Next, copy `.env.example` to `.env` and edit appropriately. Running this app locally will likely not work since the IdP can't redirect to `localhost`.

Registering the Service Provider
================================
Fill out BU's [Service Provider Checklist](https://www.bu.edu/tech/services/security/iam/authentication/shibboleth/service-provider-checklist/) form to register your application (for the "Service Provider Metadata" textbox, go to your app's `/shibboleth/metadata` route and copy the entire XML content into the textbox). After a few days, it will be processed and your authentication setup will be live!

Usage
=====
```
yarn install
yarn start
```

Shoutout to Dharmesh Tarapore's [BU Shibboleth guide](https://cs-people.bu.edu/dharmesh/teaching/shibboleth/) for Apache, it was very useful in figuring out the BU specific configuration for `passport-saml`. Another shoutout to the [RIT Student Goverment](https://github.com/ritstudentgovernment), who's repo we forked.